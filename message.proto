syntax = "proto3";

package prb;

import "google/protobuf/timestamp.proto";
import "utils.proto";
import "error.proto";

enum MessageType {
  MTP_BROADCAST = 0;
  MTP_QUERY = 1;
  MTP_REPLY = 2;
  MTP_NOTIFY = 3;
}

enum MessageTarget {
  MTG_BROADCAST = 0;
  MTG_MANAGER = 1;
  MTG_TRADE_SCHEDULER = 2;
  MTG_TRADE_WORKER = 3;
  MTG_WORKER = 4;
  MTG_INTERNAL_PRESERVED = 5;
}

message MessageContent {
  oneof type { // main rpc route switch
    bytes encrypted = 1; // MessageContent encoded+encrypted
    Error error = 2;
    Ack ack = 3;
    Placeholder worker_state_update = 4;
    Placeholder query_worker_state = 5;
    Placeholder account_state_update = 6;
    Placeholder query_account_state = 7;
    Placeholder request_kick_worker = 8;
    Placeholder worker_should_exit = 9;
    Placeholder trade_scheduler_state_update = 10;
    Placeholder call_online_scheduler = 11;
    Placeholder fetcher_state_update = 12;
    Placeholder call_online_fetcher = 13;
    Placeholder lifecycle_manager_state_update = 14;
    Placeholder call_online_lifecycle_manager = 15;

    Placeholder request_create_worker = 16;
    Placeholder request_start_worker_lifecycle = 17;
    Placeholder are_you_there = 18;
    Placeholder request_update_worker = 19;
  }
}

message Message {
  MessageTarget from = 1;
  MessageTarget to = 2;
  MessageContent content = 3;
  google.protobuf.Timestamp created_at = 4; // required
  uint64 nonce = 5; // required
  uint64 nonce_ref = 6; // 0 => none
  MessageType type = 7;
  MessageProcedure procedure = 8;
}